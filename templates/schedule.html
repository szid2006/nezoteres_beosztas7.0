<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Beosztás</title>
</head>
<body>

<h1>Nézőtéri beosztás</h1>

{% for show in schedule %}
    <hr>
    <h2>{{ show.cím }} – {{ show.dátum }}</h2>

    {% if show.hiba %}
        <p style="color:red;">⚠️ {{ show.hiba }}</p>
    {% else %}
        {% for s in show.szerepek %}
            <strong>{{ s.szerep }}</strong>
            {% if s.kiosztott|length < s.kért %}
                <span style="color:red;">
                    ({{ s.kiosztott|length }}/{{ s.kért }})
                </span>
            {% endif %}
            <ul>
                {% for d in s.kiosztott %}
                    {% set w = workers | selectattr("név", "equalto", d) | first %}
                    <li style="{% if w and w.ÉK == 'igen' %}color:red;{% endif %}">
                        {{ d }}{% if w and w.ÉK == 'igen' %} (ÉK){% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endfor %}
    {% endif %}
{% endfor %}

</body>
</html>
