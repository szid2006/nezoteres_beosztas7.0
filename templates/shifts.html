<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>M≈±szakok</title>
    <style>
        .role-block {
            margin-bottom: 15px;
        }
        .boxes {
            display: inline-block;
        }
        .boxes input {
            margin-right: 4px;
        }
    </style>
</head>
<body>

<h2>M≈±szak hozz√°ad√°sa</h2>

<form method="post" onsubmit="prepareCounts()">
    <label>El≈ëad√°s neve:</label><br>
    <input name="show" required><br><br>

    <label>Id≈ëpont:</label><br>
    <input type="datetime-local" name="datetime" required><br><br>

    <h3>Munkak√∂r√∂k</h3>

    {% for role in roles %}
        <div class="role-block">
            <b>{{ role }}</b><br>

            <div class="boxes">
                {% for i in range(10) %}
                    <input type="checkbox"
                           class="role-box"
                           data-role="{{ role }}">
                {% endfor %}
            </div>

            <!-- ide √≠rjuk majd be a darabsz√°mot JS-b≈ël -->
            <input type="hidden" name="{{ role }}" value="0">
        </div>
    {% endfor %}

    <br>
    <button type="submit">M≈±szak hozz√°ad√°sa</button>
</form>

<hr>

<h3>Felvett m≈±szakok ({{ shifts|length }} db)</h3>

<ul>
{% for s in shifts %}
    <li>
        {{ s.show }} ‚Äì {{ s.datetime }}<br>
        {{ s.roles }}
    </li>
{% endfor %}
</ul>

<br>
<a href="/workers">‚Üí Tov√°bb az emberekhez</a>

<script>
function prepareCounts() {
    const roles = {};

    document.querySelectorAll(".role-box").forEach(box => {
        const role = box.dataset.role;
        if (!(role in roles)) {
            roles[role] = 0;
        }
        if (box.checked) {
            roles[role]++;
        }
    });

    for (const role in roles) {
        const hidden = document.querySelector(
            'input[type="hidden"][name="' + role + '"]'
        );
        if (hidden) {
            hidden.value = roles[role];
        }
    }
}
    <hr>

<h3>Excel import</h3>

<form method="post" action="/import" enctype="multipart/form-data">
    <input type="file" name="file" accept=".xlsx" required>
    <button type="submit">üì• Import Excelb≈ël</button>
</form>

</script>

</body>
</html>
