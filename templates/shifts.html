<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Műszakok</title>
    <style>
        .role-block {
            margin-bottom: 15px;
        }
        .boxes {
            display: inline-block;
        }
        .boxes input {
            margin-right: 4px;
        }
    </style>
</head>
<body>

<h2>Műszak hozzáadása</h2>

<form method="post" onsubmit="prepareCounts()">
    <label>Előadás neve:</label><br>
    <input name="show" required><br><br>

    <label>Időpont:</label><br>
    <input type="datetime-local" name="datetime" required><br><br>

    <h3>Munkakörök</h3>

    {% for role in roles %}
        <div class="role-block">
            <b>{{ role }}</b><br>

            <div class="boxes">
                {% for i in range(10) %}
                    <input type="checkbox"
                           class="role-box"
                           data-role="{{ role }}">
                {% endfor %}
            </div>

            <!-- ide írjuk majd be a darabszámot JS-ből -->
            <input type="hidden" name="{{ role }}" value="0">
        </div>
    {% endfor %}

    <br>
    <button type="submit">Műszak hozzáadása</button>
</form>

<hr>

<h3>Felvett műszakok ({{ shifts|length }} db)</h3>

<ul>
{% for s in shifts %}
    <li>
        {{ s.show }} – {{ s.datetime }}<br>
        {{ s.roles }}
    </li>
{% endfor %}
</ul>

<br>
<a href="/workers">→ Tovább az emberekhez</a>

<script>
function prepareCounts() {
    const roles = {};

    document.querySelectorAll(".role-box").forEach(box => {
        const role = box.dataset.role;
        if (!(role in roles)) {
            roles[role] = 0;
        }
        if (box.checked) {
            roles[role]++;
        }
    });

    for (const role in roles) {
        const hidden = document.querySelector(
            'input[type="hidden"][name="' + role + '"]'
        );
        if (hidden) {
            hidden.value = roles[role];
        }
    }
}
</script>

</body>
</html>
